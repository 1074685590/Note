# 述职

## Android业务支撑与技术积累

​	Android业务支撑我主要负责过东家小院的研发和领现金项目框架的搭建以及关注组件的封装和维护工作。在这些Android项目的不断迭代过程中，我曾碰到过三个问题：

>- 代码结构混乱
>
> 东家小院是我从0到1搭建起来的第一个项目，由于早期对项目的架构知识掌握不足，导致代码结构混乱，层次不清；
>
>- 技术方案不统一
>
> 由于在项目工时紧张时有其他团队成员的研发支持，大家为了项目的快速上线，各自采用了自己熟悉的技术方案，导致项目技术一致性越来越差，业务代码逻辑难以理解；
>
>- 冗余代码
>
> 同一套代码中封装了很多功能类似的组件，这些高度定制的组件复用性不强，不仅增加了包大小，而且增加了项目后期的维护成本；

​	为了解决这些问题，我在需求的迭代过程中不断的进行小范围的改进，参考Google推出的基于MVP架构的demo，并结合自己累积的经验，对东家小院项目针对性的做了相应的调整，最后形成了一套自己的项目搭建方案并且在后续的领现金项目的搭建过程中进行了应用：图中所示的就是领现金的项目架构。

​	在传统的mvp架构的基础上，我加入了一个契约类Contract来统一管理View和Presenter的接口，另外，由于大量的业务逻辑处理会转移到了Presenter层，在一些复杂的业务场景中Presenter层同样会变得臃肿难懂。所以，我引入了Data Repository 模块，这个模块的作用是可以将原本由Presenter处理的部分逻辑转移到这里来处理，包括数据的校验、部分单纯只与数据相关的逻辑等，向Presenter屏蔽数据处理细节。这样就形成了一个改进版的MVP框架。采用这个框架，我们项目的可维护性得到了根本的改善。

​	除了在架构层面上进行功能细分之外，我还通过分包、类描述和方法注释使得代码有了足够明确的开发规范和标准。细致到了每一个类应该放到哪个包下，哪个类具体应该负责什么职责等。这对于我们的Code Review、接手他人的功能模块等都提供了极大的便利。

通过上述的架构基本上可以解决第一个问题，

第二个问题通过在项目中引入常用的library并在基类中进行封装对外提供统一的调用接口并做好注释与方法调用示例说明，如有必要还可以通过对外提供抽象方法或者接口供调用方自己去实现相关方法。

第三个问题通过封装通用化的组件解决，太小的公有模块不足以构成单独组件，我们先放到Common层中，在后期不断的重构迭代中视情况进行进一步的拆分。比如，在领现金的开发过程中，我需要一个支持带有2个头布局和一个脚布局的列表控件，但是项目已经存在一个类似的列表控件，由于其不支持多个头布局而不能复用，我对其进行了通用化改造，既去除了冗余代码，又减少了代码的维护成本。

## RN业务支撑与技术积累

​	我主要负责的是领京豆模块以及领京豆大促活动页的研发工作，自我接手领京豆模块后，总共进行了两次大改版，四个大促活动页的研发工作。其中领京豆首页2.0版本日均uv 630W，组团瓜分京豆活动页双十一当天的uv达到了963W。在这些业务的迭代过程中我面临的主要挑战分别是：

> - 维护成本高
>
> - 体验问题
>
> - 工时压力
>

针对这些问题，我主要从三个方面去解决：

> - 降低代码的维护成本
>
>   在业务粒度上，将代码按照业务逻辑进行分拆解耦。
>
>   ​	H5进行了发布平台的迁移。RN转H5之前是由devops平台发布js静态资源，然后再通过CMS平台修改js静态资源指向的配置文件来进行发布的，由于CMS发布平台维护的配置文件中涉及到多个业务，存在误操作导致线上业务受到影响的风险，为了去除这种风险，我经过不断的尝试，最终通过修改RN转H5的脚本文件中的配置项，成功将RN转H5在通天塔平台上发布成功，有效降低了RN转H5项目上线的维护成本，并输出了RN转H5的指导文档。
>
>   ​	RN部分进行了弹窗治理，领京豆首页1.0版本交接过来后，我发现存在着在多个弹窗同时弹出的潜在问题，经过对涉及到11种弹窗进行梳理输出了领京豆弹窗的说明文档并推动了后端针对弹窗的问题制定了弹窗优先级的下发逻辑并完善了前端的兜底，保证了用户的体验。
>
> - 组件封装 ////这里斟酌一下
>
>   ​	在组件粒度上，为了避免重复开发和降低项目的复杂度，领京豆封装的可复用组件11个，这些组件有效的提升了模块的开发效率。同时在研发流程上，推动项目组将视觉排期纳入研发周期，使研发过程更加完整，降低了个别环节对整体进度的影响。其中领京豆的2.0版本RN+H5单人22工作日就完成了研发。
>
> - 性能优化 ////这里和ppt中的数据对应一下
>
>   ​	为了节省cpu和内存的开销，通过对列表在滑动的过程中可见性发生的变化的图片进行色块替换，避免了图片的无效加载。其次就是包大小的优化，领京豆的bundle中存在大量的本地图片，通过对这些图片进行分类，简单icon通过引入iconfont进行替换，大图和加载频率低的图片将其上传至JFS平台进行网络加载。通过性能优化，领京豆首页的首开耗时减少了128ms，jsBundle减少了131KB。

## 关注组件的开发与优化

由于首页大改版，多数频道失去了首页的资源位，频道为了提高用户的留存率往往会开发自己频道的关注组件，但是站内频道众多，使得各个频道开发关注组件可能存在以下几个问题：

> - 重复开发
>
> - 依赖发版
>
> - 维护成本高
>
> - 运营成本高
>

为了解决上述问题，我们在产品和技术上规划并实现了一套通用的关注组件：

> - 全平台支持
>
>   关注组件对原生和H5以及RN提供了一致的频道关注能力，简化了接入方式；
>
> - 通用的弹窗策略
>
>   关注组件在引导用户关注频道、关注领京豆或者关注领优惠券等场景下提供了弹窗能力，制定出一套完整的弹窗策略；
>
> - 兼容性高
>
>   关注组件针对不同的平台和折叠屏做了兼容处理；关注组件内部还针对异常情况作了完善的兜底，比如Android中常见的弹窗泄露问题。
>

这就是关注组件的架构图。

通过上述的关注组件的功能封装，实现了一个多平台支持、高可用、高性能、易接入的全站通用的关注组件，目前关注组件接入业务300+，总关注人数达到了3.5亿。

## 一种跨平台动态化的弹窗方案

​	在使用Android和RN开发弹窗支持各种业务的过程中，我们发现弹窗开发作为一种关键的视图要素在频道的开发过程中必不可少，但是弹窗的UI样式、弹出方式有很大的相似性。我们总结了目前弹窗开发的四个现状：

> - 重复开发
>
> - 技术栈不统一
>
> - 配置不灵活
>
> - 依赖发版
>

​	针对这些问题，我们团队提出了一种跨平台动态化弹窗方案，如流程图所示，左边是传统的烟囱式的弹窗研发模式，右边是跨平台动态化的弹窗研发模式。最右边就是这种弹窗方案的架构图，我的主要工作就是预研VK、RN、H5弹窗的动态加载方案并输出Demo，为了支持不同技术实现的弹窗，封装了通用的弹窗框架并提供接口供不同的技术方案进行接入，同时还针对不同技术方案的差异部分进行了适配，向上提供一致的方法入口。

> - VK属于我们团队内部自研的一个动态化前端方案，为了通用性网络和图片框架需要各个业务实现相应的接口进行扩展。我通过主站内提供的网络和图片框架接入VK并实现弹窗相关的逻辑。
> - RN弹窗的bundle文件通过RN框架提供的容器进行加载，并通过实现弹窗框架的接口完善弹窗相关的能力。
> - H5通过XView提供的能力进行了接入，并采用适配器模式将XView的相关方法进行了适配。

​	此Demo作为XView 2.0的预研项目输出了一篇专利。

## RN性能监控工具

今年我们部门规划了客户端性能监控项目，我负责Android端的RN性能监控的研发工作，通过调研我发现RN的性能监控工具需要具备的三个能力：

> - 准确打点
>
> - 实时上报
>
> - 自动采集
>

​	具体实现过程如右图。RN性能监控信息来源主要是jsBridge，RN FrameWork，RN容器。首先看一下jsBridge上报信息过程，在RN页面的加载过程中其接口请求相关的打点数据通过hook接口请求方法的方式获取，同时还支持业务自定信息的上报。

​	通过研读RN Android端FrameWork的源码发现存在一种可以反映了RN运行过程的通知信息。这些通知信息的种类有300多种，通过深入源码从这些通知信息中筛选出能够反映RN性能指标的几种通知。通过RN提供的监听回调获取到这些信息。

​	还有一些反映RN模块的描述信息可以通过加载RN Moudle的容器中获取，我通过获取跳转到RN所在的activity的intent对象后，我们从中解析到了当前所加载RN模块的基本描述信息。

通过上述的过程实现了RN性能监控的完整的能力，其特点为：

> - 自动上报的无侵入
>
> - 手动上报易接入
>
> - 数据串联易定位
>

目前支持的性能指标为JSBundle加载时长、接口请求耗时、首开耗时、内存占用大小，其他性能指标由原生部分负责上报。通过与烛龙项目的合作，目前此工具已经作为烛龙项目的一部分实现了平台化。服务业务10+，包含领京豆、京东超市、逛好店等RN模块。我们也通过这个监控系统发现了一些问题并进行了解决，比如领京豆首页模块1.0版本的jsBundle的加载时间均值在安卓端达到了509ms，通过对领京豆首页模块的jsBundle的拆包和瘦身后jsBundle的加载时间均值已经在154ms，优化效果明显。

