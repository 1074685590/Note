# DQL-多表查询

select * 

from emp, dept, (select * from emp)

where

group by

having

order by

desc

limit

**多表查询**

  \1. 分类：

​    \* 合并结果集(了解)

​    \* 连接查询

​    \* 子查询

合并结果集(结果集相同而不是表完全相同)

  \* 要求被合并的表中，列的类型和列数相同

   ![image-20221029174902943](img/image-20221029174902943.png)

  ![image-20221029174909646](img/image-20221029174909646.png)

  \* UNION，去除重复行

![image-20221029174917100](img/image-20221029174917100.png)

  ![image-20221029174923331](img/image-20221029174923331.png)

  \* UNION ALL，不去除重复行

SELECT * FROM cd

UNION ALL

SELECT * FROM ab;

 ![image-20221029174934649](img/image-20221029174934649.png)

 ![image-20221029174942548](img/image-20221029174942548.png)

**连接查询**

  \1. 分类

​    \* 内连接

​    \* 外连接

​      \> 左外连接

​      \> 右外连接

​      \> 全外连接(MySQL不支持)

​    \* 自然连接（属于一种简化方式）

  \2. 内连接

 ![image-20221029174955052](img/image-20221029174955052.png)

链接表之间的关联键做笛卡尔积显示

  ![image-20221029175003986](img/image-20221029175003986.png)

​    \* 方言：SELECT * FROM 表1 别名1, 表2 别名2 WHERE 别名1.xx=别名2.xx

  ![image-20221029175016639](img/image-20221029175016639.png)

  ![image-20221029175102197](img/image-20221029175102197.png)

​    ![image-20221029175109512](img/image-20221029175109512.png)

​    ![image-20221029175117454](img/image-20221029175117454.png)

  ![image-20221029175125375](img/image-20221029175125375.png)

​    ![image-20221029175131456](img/image-20221029175131456.png)

​    \* 标准：SELECT * FROM 表1 别名1 INNER JOIN 表2 别名2 ON 别名1.xx=别名2.xx

​    ![image-20221029175139418](img/image-20221029175139418.png)

  ![image-20221029175145741](img/image-20221029175145741.png)

​    \* 自然：SELECT * FROM 表1 别名1 NATURAL JOIN 表2 别名2

 ![image-20221029175154491](img/image-20221029175154491.png)

![image-20221029175200453](img/image-20221029175200453.png)

​    \* 内连接查询出的所有记录都满足条件。

  

  **3. 外连接**

​    \* 左外：SELECT * FROM 表1 别名1 LEFT OUTER JOIN 表2 别名2 ON 别名1.xx=别名2.xx

​      \> 左表记录无论是否满足条件都会查询出来，而右表只有满足条件才能出来。左表中不满足条件的记录，右表部分都为NULL

  ![image-20221029175210899](img/image-20221029175210899.png)

 ![image-20221029175218255](img/image-20221029175218255.png)

  ![image-20221029175224821](img/image-20221029175224821.png)

![image-20221029175232092](img/image-20221029175232092.png)

​    \* 左外自然：SELECT * FROM 表1 别名1 NATURAL LEFT OUTER JOIN 表2 别名2 ON 别名1.xx=别名2.xx

​    \* 右外：SELECT * FROM 表1 别名1 RIGHT OUTER JOIN 表2 别名2 ON 别名1.xx=别名2.xx

​      \> 右表记录无论是否满足条件都会查询出来，而左表只有满足条件才能出来。右表不满足条件的记录，其左表部分都为NULL

   ![image-20221029175240761](img/image-20221029175240761.png)

![image-20221029175246868](img/image-20221029175246868.png)

​    \* 右外自然：SELECT * FROM 表1 别名1 NATURAL RIGHT OUTER JOIN 表2 别名2 ON 别名1.xx=别名2.xx

​    \* 全链接：可以使用UNION来完成全链接

   ![image-20221029175254683](img/image-20221029175254683.png)

 ![image-20221029175301241](img/image-20221029175301241.png)

**子查询**

　　：查询中有查询（查看select关键字的个数！）

  \1. 出现的位置：

​    \* where后作为条件存在

​    ![image-20221029175312299](img/image-20221029175312299.png)

![image-20221029175319151](img/image-20221029175319151.png)

​    \* from后作为表存在(多行多列)

​    ![image-20221029175327501](img/image-20221029175327501.png)

  ![image-20221029175335739](img/image-20221029175335739.png)

​    ![image-20221029175342917](img/image-20221029175342917.png)

  ![image-20221029175349675](img/image-20221029175349675.png)

  \2. 条件

​    \* (***)单行单列：SELECT * FROM 表1 别名1 WHERE 列1 [=、>、<、>=、<=、!=] (SELECT 列 FROM 表2 别名2 WHERE 条件)

   ![image-20221029175400594](img/image-20221029175400594.png)

   ![image-20221029175406741](img/image-20221029175406741.png)

​    \* (**)多行单列：SELECT * FROM 表1 别名1 WHERE 列1 [IN, ALL, ANY] (SELECT 列 FROM 表2 别名2 WHERE 条件)

​    ![image-20221029175414581](img/image-20221029175414581.png)

![image-20221029175420153](img/image-20221029175420153.png)

​    ![image-20221029175427812](img/image-20221029175427812.png)

![image-20221029175434127](img/image-20221029175434127.png)

  

  ![image-20221029175442967](img/image-20221029175442967.png)

![image-20221029175449874](img/image-20221029175449874.png)

  \* (*)单行多列：SELECT * FROM 表1 别名1 WHERE (列1,列2) IN (SELECT 列1, 列2 FROM 表2 别名2 WHERE 条件)

  ![image-20221029175500062](img/image-20221029175500062.png)

   ![image-20221029175507619](img/image-20221029175507619.png)

![image-20221029175515552](img/image-20221029175515552.png)

  ![image-20221029175522478](img/image-20221029175522478.png)

![image-20221029175529180](img/image-20221029175529180.png)

![image-20221029175535108](img/image-20221029175535108.png)

  \* (***)多行多列：SELECT * FROM 表1 别名1 , (SELECT ....) 别名2 WHERE 条件

====================================================

笛卡尔积

{a, b, c} {1,2}

{a1, a2, b1, b2, c1, c2}

====================================================

\1. 查出至少有一个员工的部门。显示部门编号、部门名称、部门位置、部门人数。

  ![image-20221029175545790](img/image-20221029175545790.png)

![image-20221029175552267](img/image-20221029175552267.png)

\3. 列出所有员工的姓名及其直接上级的姓名。

![image-20221029175600936](img/image-20221029175600936.png)

 ![image-20221029175607834](img/image-20221029175607834.png)

  ![image-20221029175614181](img/image-20221029175614181.png)

  ![image-20221029175621912](img/image-20221029175621912.png)

\4. 列出受雇日期早于直接上级的所有员工的编号、姓名、部门名称。

  ![image-20221029175630778](img/image-20221029175630778.png)

![image-20221029175636989](img/image-20221029175636989.png)

\5. 列出部门名称和这些部门的员工信息，同时列出那些没有员工的部门。

​    ![image-20221029175644650](img/image-20221029175644650.png)

 ![image-20221029175652346](img/image-20221029175652346.png)

\7. 列出最低薪金大于15000的各种工作及从事此工作的员工人数。

   ![image-20221029175659371](img/image-20221029175659371.png)

![image-20221029175705636](img/image-20221029175705636.png)

\8. 列出在销售部工作的员工的姓名，假定不知道销售部的部门编号。

  ![image-20221029175721068](img/image-20221029175721068.png)

  ![image-20221029175727267](img/image-20221029175727267.png)

\9. 列出薪金高于公司平均薪金的所有员工信息，所在部门名称，上级领导，工资等级。

   ![image-20221029175734296](img/image-20221029175734296.png)

 ![image-20221029175740712](img/image-20221029175740712.png)

10.列出与庞统从事相同工作的所有员工及部门名称。

![image-20221029175748919](img/image-20221029175748919.png)

   ![image-20221029175755492](img/image-20221029175755492.png)

11.列出薪金高于在30部门工作的所有员工的薪金的员工姓名和薪金、部门名称。

![image-20221029175803152](img/image-20221029175803152.png)

 ![image-20221029175809623](img/image-20221029175809623.png)

13.查出年份、利润、年度增长比

 ![image-20221029175818261](img/image-20221029175818261.png)

![image-20221029175824991](img/image-20221029175824991.png)

\2. 列出薪金比关羽高的所有员工。

\6. 列出所有文员的姓名及其部门名称，部门的人数。

12.列出每个部门的员工数量、平均工资。